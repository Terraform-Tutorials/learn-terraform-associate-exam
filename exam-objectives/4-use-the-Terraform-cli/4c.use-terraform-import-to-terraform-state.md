# Given a scenario: choose when to use `terraform import` to import existing infrastructure into your Terraform state
esse comando faz o `import` de recursos criados sem o terraform (de forma manual pelo console) para dentro da estrutura do terraform, dentro do escopo de hcl.

## Command: import
a ideia desse comando é justamente importar uma configuração existentes para dentro do terraform.

## Usage

`terraform import [options] ADDRESS ID`

com o uso do ID do recurso e possível fazer esse import para o arquivo de state do terraform de acordo com o endereço usado do recurso. importante notar que o ID depende do tipo de recurso que está sendo importado, sabemos que por exempos em instâncias EC2 da AWS, temos o instance ID `(i-abcd1234)`, mas existem outros recursos que o ID muda, como por exemplo o recurso de Route 53 da AWS, que o ID é outro formato zone ID `(Z12ABC4UGMOZ2N)`. por isso sempre busque mais detalhes com a doc do provedor que você está usando.

## Import Terraform Configuration
vamos fazer um lab seguindo a doc do terraform para mostrar como que funciona o passo a passo para importar uma infraestrutura existente para o terraform.

para que seja possível criar uma nova infraestrutura, temos que seguir alguns passos importantes para obtermos a visao da infraestrutura.

1. escrever os arquivos de configuração que definem a infraestrutura que eu desejo criar.
2. revisar  o plano do terraform opara garantior que a configuração resultará na infraestrutura esperada.
3. aplicar a configuração para ter criada a infraestrutura com o terraform.

legal de citar também que o terraform suporta migrar uma infraestrutura existente para dentro do terraform state, temos que usar o comando `terraform import` sabendo que, esse comando não gera nenhuma template da sua infraestrutura, você precisa gerar o bloco que está planejando importar para dentro do terraform.

- se for uma instância virtual, precisa declarar o bloco de EC2 da AWS por exemplo.
- se for um banco de dados, tem que fazer o mesmo processo, declarando o bloc de recursos.

para que seja possível isso, devemos clocar a infraestrutura existente sob o controle da Terraform que envolve cinco etapas:

1. Identifique a infraestrutura existente que você irá importar.
2. Importe a infraestrutura para o estado do Terraform.
3. Grave a configuração do Terraform que corresponda a essa infraestrutura.
4. Revise o plano do Terraform para garantir que a configuração corresponda ao estado e à infraestrutura esperados.
5. Aplique a configuração para atualizar seu estado do Terraform.

![terra](https://github.com/Terraform-Tutorials/learn-terraform-associate-exam/blob/main/exam-objectives/images/terra4.png) 

## Prerequisites
vamos seguir com uma demonstração de como podemos importar uma infraestrutura pré existente para o terraform:

- The Terraform CLI.
- Docker installed and running.
- The git CLI.

## Create the Docker container
primeiramente devemos criar  o container de nome `hashicorp-learn` usando a imagem do NGINX que sera baixada do DockerHub.

`docker run --name hashicorp-learn --detach --publish 8080:80 nginx:latest`

- vamos executar o comando acima para prosseguir com o container:

```bash
# docker container run --name hashicorp-learn --detach --publish 8080:80 nginx:latest
Unable to find image 'nginx:latest' locally
latest: Pulling from library/nginx
3f4ca61aafcd: Pull complete
50c68654b16f: Pull complete
3ed295c083ec: Pull complete
40b838968eea: Pull complete
88d3ab68332d: Pull complete
5f63362a3fa3: Pull complete
Digest: sha256:0047b729188a15da49380d9506d65959cce6d40291ccfb4e039f5dc7efd33286
Status: Downloaded newer image for nginx:latest
6b53e225ecc54e32438157c75e9213e351bb250b1f9bf20002523e02cbbcab37
```

- visualizando o container que foi criado:

```bash
# docker container ls
CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                                   NAMES
6b53e225ecc5   nginx:latest   "/docker-entrypoint.…"   7 seconds ago   Up 5 seconds   0.0.0.0:8080->80/tcp, :::8080->80/tcp   hashicorp-learn
```

